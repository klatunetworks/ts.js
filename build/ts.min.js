// ts.js - version 0.9.2
//
// Copyright 2012 Dan Simpson, Mike Countis
//
// MIT License
var $ts=(()=>{var g=(m,f)=>()=>(f||m((f={exports:{}}).exports,f),f.exports);var b=g((c,v)=>{(function(){var m,f,o,d,l;d=class{constructor(){}validate(t){if(t.length===0)throw"Timeseries expects an array of data.";if(t[0].length!==2)throw"Timeseries expects input like [[timestamp, value]...]";if(typeof t[0][0]!="number")throw"Timeseries expects timestamps; eg: [[timestamp, value]...]"}timestamp(t,e=new Date().getTime(),s=6e4){var i,r,h,n,a;for(i=0,n=[],r=0,h=t.length;r<h;r++)a=t[r],n.push([e+i++*s,a]);return n}wrap(t,e=!0){return e&&this.validate(t),new o(t)}numeric(t,e=!0){if(e&&(this.validate(t),typeof t[0][1]!="number"))throw"NumericTimeseries expects timestamps and numbers; eg: [[timestamp, number]...]";return new f(t)}multi(t,e=!0){return e&&this.validate(t),new m(t)}build(t){return this.validate(t),typeof t[0][1]=="number"?this.numeric(t):typeof t[0][1]=="string"?this.wrap(t):this.multi(t)}},l=new d,o=class{constructor(t){this.data=t,this.squelched=!1,this.listeners=[],this.init_listeners=[],this.timeframe=null}size(){return this.data.length}empty(){return this.data.length===0}length(){return this.data.length}count(){return this.data.length}slice_indices(t,e){var s,i;return s=this.nearest(t),i=this.nearest(e),this.time(s)<t&&++s,this.time(i)<e&&++i,[s,i]}limit(t){return this.timeframe=t,this}behead(){var t,e,s;if(this.timeframe===null)return[];for(s=this.end()-this.timeframe,t=0;this.data[t][0]<s;)t++;return e=this.data.slice(0,t),this.data=this.data.slice(t),e}first(){return this.data[0]}last(){return this.data[this.size()-1]}sample(t){return this.data[t]}time(t){return this.data[t][0]}value(t){return this.data[t][1]}domain(){return[this.first()[0],this.last()[0]]}append(t,e){if(this.empty()){this.data.push([t,e]);return}if(t<this.end())throw"Can't append sample with past timestamp";return this.data.push([t,e]),this.behead(),this.notify()}push(t,e){return this.append(t,e)}add(t,e){return this.append(t,e)}notify(){var t,e,s,i,r,h,n,a;if(!this.squelched){if(this.size()===2)for(h=this.init_listeners,t=0,s=h.length;t<s;t++)r=h[t],r();for(n=this.listeners,a=[],e=0,i=n.length;e<i;e++)r=n[e],a.push(r());return a}}listen(t){return this.listeners.push(t)}on_init(t){return this.init_listeners.push(t)}values(){var t,e,s,i,r,h;for(s=[],i=this.data,t=0,e=i.length;t<e;t++)[r,h]=i[t],s.push(h);return s}duration(){return this.end()-this.start()}start(){return this.first()[0]}end(){return this.last()[0]}scan(t,e){var s,i;return[s,i]=this.slice_indices(t,e),new this.constructor(this.data.slice(s,i))}filter(t){var e,s,i,r,h;for(i=[],r=this.data,e=0,s=r.length;e<s;e++)h=r[e],t(h[0],h[1])&&i.push(h);return new this.constructor(i)}split(t){var e,s,i,r,h,n;for(i=[],r=[],h=this.data,e=0,s=h.length;e<s;e++)n=h[e],n[0]<=t?i.push(n):r.push(n);return[new this.constructor(i),new this.constructor(r)]}partition(t){var e,s,i,r,h,n,a,u;for(a=this.start()-Math.abs(this.start()%t),h=[],e=[],r=this.data,s=0,i=r.length;s<i;s++){for([n,u]=r[s];n-a>=t;)h.push([a,l.build(e)]),e=[],a+=t;e.push([n,u])}return e.length>0&&h.push([a,l.build(e)]),l.wrap(h,!1)}map(t){var e,s,i,r,h;for(i=[],r=this.data,e=0,s=r.length;e<s;e++)h=r[e],i.push(t(h[0],h[1]));return l.build(i)}pfold(t,e){return this.partition(t).map(e)}timestamps(){var t,e,s,i,r,h;for(s=[],i=this.data,t=0,e=i.length;t<e;t++)[r,h]=i[t],s.push(r);return s}nearest(t,e=!1){var s;return t<=this.start()?0:t>=this.end()?this.size()-1:(s=this.bsearch(t,0,this.size()-1),e&&this.time(s)>t&&(s=Math.max(0,s-1)),s)}bsearch(t,e,s){var i,r,h;return h=Math.floor((s-e)/2)+e,e===h?(i=Math.abs(this.time(e)-t),r=Math.abs(this.time(s)-t),r>i?e:s):t<this.time(h)?this.bsearch(t,e,h):t>this.time(h)?this.bsearch(t,h,s):h}toString(){return`Timeseries
items   : ${this.size()}
domain  : ${this.domain()}`}},f=class extends o{constructor(t){super(t)}statistics(){var t,e,s,i,r,h,n,a;if(this._stats)return this._stats;for(h=0,i=1/0,s=-1/0,r=this.data,t=0,e=r.length;t<e;t++)[n,a]=r[t],h+=a,a>s&&(s=a),a<i&&(i=a);return this._stats={sum:h,min:i,max:s}}behead(){var t,e,s,i,r;if(t=super.behead(),!(t.length===0||!this._stats)){for(e=0,s=t.length;e<s;e++)if([i,r]=t[e],this._stats.sum-=r,r===this._stats.min||r===this._stats.max){this._stats=!1;return}}}append(t,e){if(t<this.end())throw"Can't append sample with past timestamp";return this._stats&&(this._stats.sum+=e,this._stats.min=Math.min(this._stats.min,e),this._stats.max=Math.max(this._stats.max,e)),super.append(t,e)}sum(){return this.statistics().sum}sumsq(){var t,e,s,i,r,h,n,a;for(s=this.mean(),r=0,h=this.data,t=0,e=h.length;t<e;t++)[n,a]=h[t],i=a-s,r+=i*i;return r}variance(){return this.sumsq()/(this.size()-1)}stddev(){return Math.sqrt(this.variance())}mean(){return this.sum()/this.size()}range(){return[this.min(),this.max()]}span(){return this.max()-this.min()}min(){return this.statistics().min}max(){return this.statistics().max}values(){var t,e,s,i,r,h;for(s=[],i=this.data,t=0,e=i.length;t<e;t++)[r,h]=i[t],s.push(h);return s}valuesSorted(){return this._valuesSorted?this._valuesSorted:this._valuesSorted=this.values().sort(function(t,e){return t-e})}quartiles(){return{min:this.min(),p25:this.p25th(),mid:this.median(),p75:this.p75th(),max:this.max()}}p25th(){return this.percentile(.25)}p75th(){return this.percentile(.75)}median(){return this.percentile(.5)}percentile(t){var e;return e=Math.floor(this.size()*t),this.size()%2?this.valuesSorted()[e]:(this.valuesSorted()[e-1]+this.valuesSorted()[e])/2}norms(){var t,e,s,i,r,h;for(s=[],i=this.data,t=0,e=i.length;t<e;t++)[r,h]=i[t],s.push((h-this.mean())/this.stddev());return s}simplify(t=.1){var e,s,i,r,h,n,a;for(s=this.first(),h=this.max()-this.min(),r=[s],n=this.data,e=0,i=n.length;e<i;e++)a=n[e],Math.abs(a[1]-s[1])/h>t&&(s[0]!==r[r.length-1][0]&&r.push(s),r.push(a)),s=a;return s[0]!==r[r.length-1][0]&&r.push(s),l.build(r)}match(t){var e,s,i,r,h,n,a,u;if(!(t instanceof o))throw"Must match against a Timeseries object";if(e=999999999,r=-1,n=t.norms(),u=this.norms(),!(n.length<=u.length))throw"Query length exceeds source length";for(i=h=0,a=u.length-n.length-1;0<=a?h<=a:h>=a;i=0<=a?++h:--h)s=this._distance(n,u.slice(i,+(i+n.length)+1||9e9)),s<e&&(e=s,r=i);return r}_distance(t,e){var s,i,r,h,n;if(t.length!==e.length)throw"Array lengths must match for distance";for(n=0,i=r=0,h=t.length-1;0<=h?r<=h:r>=h;i=0<=h?++r:--r)s=e[i]-t[i],n+=s*s;return Math.sqrt(n)}toString(){return`Timeseries
items   : ${this.size()}
mean    : ${this.mean()}
stddev  : ${this.stddev()}
domain  : ${this.domain()}
range   : ${this.range()}
variance: ${this.variance()}`}},m=class extends o{constructor(t){var e,s,i,r,h,n,a,u;for(super(t),this.lookup={},this.attrs=[],h=this.data,e=0,i=h.length;e<i;e++){r=h[e],n=r[1];for(s in n)u=n[s],this.lookup.hasOwnProperty(s)||(this.lookup[s]=[],this.attrs.push(s)),this.lookup[s].push([r[0],u])}a=this.lookup;for(s in a)u=a[s],this.lookup[s]=l.build(this.lookup[s])}series(t){var e,s;return t[0]==="/"?this.series(t.substr(1)):t.indexOf("/")>0?(s=t.split("/"),e=s.shift(),this.lookup[e]?this.lookup[e].series(s.join("/")):null):this.lookup[t]?this.lookup[t]:null}get(t){return this.series(t)}limit(t){var e,s,i,r;super.limit(t),s=this.lookup,i=[];for(e in s)r=s[e],i.push(r.limit(t));return i}append(t,e){var s,i;for(s in e)i=e[s],this.lookup.hasOwnProperty(s)?this.lookup[s].append(t,i):(this.lookup[s]=l.build([[t,i]]),this.attrs.push(s));return super.append(t,e)}attr(t){return this.series(t)}serieses(){return this.attrs}min(){var t,e,s,i;e=[],s=this.lookup;for(t in s)i=s[t],i.min&&e.push(i.min());return Math.min.apply(Math,e)}max(){var t,e,s,i;e=[],s=this.lookup;for(t in s)i=s[t],i.max&&e.push(i.max());return Math.max.apply(Math,e)}exists(t){return this.series(t)!==null}},v.exports=l}).call(c)});return b();})();

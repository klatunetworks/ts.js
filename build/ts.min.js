var isString=a=>typeof a==='string';var isNumber=a=>typeof a==='number';(function(){var A,_,c,d,e,f;d=class TimeseriesFactory{constructor(){}validate(B){if(B.length===0)throw 'Timeseries expects an array of data.';if(B[0].length!==2)throw 'Timeseries expects input like [[timestamp, value]...]';if(!isNumber(B[0][0]))throw 'Timeseries expects timestamps; eg: [[timestamp, value]...]'}timestamp(C,_b=new Date().getTime(),_c=60000){var i,j,F,r,v;i=0;r=[];for(j=0,F=C.length;j<F;j++){v=C[j];r.push([_b+(i++*_c),v])}return r}wrap(_a,D=!0){D&&this.validate(_a);return new c(_a)}numeric(_A,_B=!0){if(_B){this.validate(_A);if(!isNumber(_A[0][1]))throw 'NumericTimeseries expects timestamps and numbers; eg: [[timestamp, number]...]'}return new _(_A)}multi(E,aA=!0){aA&&this.validate(E);return new A(E)}build(aB){this.validate(aB);if(isNumber(aB[0][1]))return this.numeric(aB);if(isString(aB[0][1]))return this.wrap(aB);return this.multi(aB)}};e=new d();c=class Timeseries{constructor(aC){this.data=aC;this.squelched=!1;this.listeners=this.init_listeners=[];this.timeframe=null}size(){return this.data.length}empty(){return this.data.length===0}length(){return this.data.length}count(){return this.data.length}slice_indices(aD,aE){var _C,_d;_C=this.nearest(aD);_d=this.nearest(aE);this.time(_C)<aD&&++_C;this.time(_d)<aE&&++_d;return[_C,_d]}limit(aF){this.timeframe=aF;return this}behead(){var aG,aH,aI;if(this.timeframe===null)return[];aI=this.end()-this.timeframe;aG=0;while (this.data[aG][0]<aI)aG++;aH=this.data.slice(0,aG);this.data=this.data.slice(aG);return aH}first(){return this.data[0]}last(){return this.data[this.size()-1]}sample(aJ){return this.data[aJ]}time(aK){return this.data[aK][0]}value(aL){return this.data[aL][1]}domain(){return[this.first()[0],this.last()[0]]}append(t,v){if(this.empty()){this.data.push([t,v]);return}if(t<this.end())throw 'Can\'t append sample with past timestamp';this.data.push([t,v]);this.behead();return this.notify()}push(t,v){return this.append(t,v)}add(t,v){return this.append(t,v)}notify(){var j,k,aM,_D,_e,_f,g,h;if(this.squelched)return;if(this.size()===2){_f=this.init_listeners;for(j=0,aM=_f.length;j<aM;j++){_e=_f[j];_e()}}g=this.listeners;h=[];for(k=0,_D=g.length;k<_D;k++){_e=g[k];h.push(_e())}return h}listen(fn){return this.listeners.push(fn)}on_init(fn){return this.init_listeners.push(fn)}values(){var j,aN,r,aO,v;r=[];aO=this.data;for(j=0,aN=aO.length;j<aN;j++){[t,v]=aO[j];r.push(v)}return r}duration(){return this.end()-this.start()}start(){return this.first()[0]}end(){return this.last()[0]}scan(aP,aQ){var aR,aS;[aR,aS]=this.slice_indices(aP,aQ);return new this.constructor(this.data.slice(aR,aS))}filter(aT){var j,aU,r,_E,_F;r=[];_E=this.data;for(j=0,aU=_E.length;j<aU;j++){_F=_E[j];aT(_F[0],_F[1])&&r.push(_F)}return new this.constructor(r)}split(aV){var j,aW,aX,aY,aZ,G;aX=aY=[];aZ=this.data;for(j=0,aW=aZ.length;j<aW;j++){G=aZ[j];G[0]<=aV?aX.push(G):aY.push(G)}return[new this.constructor(aX),new this.constructor(aY)]}partition(bA){var bB,j,bC,bD,bE,t,H,v;H=this.start()-Math.abs(this.start()%bA);bE=bB=[];bD=this.data;for(j=0,bC=bD.length;j<bC;j++){[t,v]=bD[j];while (t-H>=bA) {bE.push([H,e.build(bB)]);bB=[];H+=bA}bB.push([t,v])}bB.length>0&&bE.push([H,e.build(bB)]);return e.wrap(bE,!1)}map(bF){var j,bG,r,bH,bI;r=[];bH=this.data;for(j=0,bG=bH.length;j<bG;j++){bI=bH[j];r.push(bF(bI[0],bI[1]))}return e.build(r)}pfold(bJ,bK){return this.partition(bJ).map(bK)}timestamps(){var j,bL,r,bM,t;r=[];bM=this.data;for(j=0,bL=bM.length;j<bL;j++){[t,v]=bM[j];r.push(t)}return r}nearest(bN,bO=!1){var bP;if(bN<=this.start())return 0;if(bN>=this.end())return this.size()-1;bP=this.bsearch(bN,0,this.size()-1);(bO&&this.time(bP)>bN)&&(bP=Math.max(0,bP-1));return bP}bsearch(bQ,bR,bS){var bT,bU,bV;bV=~~(bS-bR)/2.0+bR;if(bR===bV){bT=Math.abs(this.time(bR)-bQ);bU=Math.abs(this.time(bS)-bQ);if(bU>bT)return bR;return bS}else{if(bQ<this.time(bV))return this.bsearch(bQ,bR,bV);if(bQ>this.time(bV))return this.bsearch(bQ,bV,bS);else return bV}}toString(){return`Timeseries
items   : ${this.size()}
domain  : ${this.domain()}`}};_=class cY extends c{constructor(bW){super(bW)}statistics(){var j,bX,bY,bZ,cA,cB,v;if(this._stats)return this._stats;cB=0.0;bZ=2e308;bY=-2e308;cA=this.data;for(j=0,bX=cA.length;j<bX;j++){[t,v]=cA[j];cB+=v;v>bY&&(bY=v);v<bZ&&(bZ=v)}return this._stats={sum:cB,min:bZ,max:bY}}behead(){var cC,j,cD,v;cC=super.behead();if(cC.length===0||!this._stats)return;for(j=0,cD=cC.length;j<cD;j++){[t,v]=cC[j];this._stats.sum-=v;if(v===this._stats.min||v===this._stats.max){this._stats=!1;return}}}append(t,v){if(t<this.end())throw 'Can\'t append sample with past timestamp';this._stats&&(this._stats.sum+=v,this._stats.min=Math.min(this._stats.min,v),this._stats.max=Math.max(this._stats.max,v));return super.append(t,v)}sum(){return this.statistics().sum}sumsq(){var j,cE,m,n,r,cF,v;m=this.mean();r=0;cF=this.data;for(j=0,cE=cF.length;j<cE;j++){[t,v]=cF[j];n=v-m;r+=n*n}return r}variance(){return this.sumsq()/(this.size()-1)}stddev(){return Math.sqrt(this.variance())}mean(){return this.sum()/this.size()}range(){return[this.min(),this.max()]}span(){return this.max()-this.min()}min(){return this.statistics().min}max(){return this.statistics().max}values(){var j,cG,r,cH,v;r=[];cH=this.data;for(j=0,cG=cH.length;j<cG;j++){[t,v]=cH[j];r.push(v)}return r}valuesSorted(){if(this._valuesSorted)return this._valuesSorted;return this._valuesSorted=this.values().sort(function(a,b){return a-b})}quartiles(){return{min:this.min(),p25:this.p25th(),mid:this.median(),p75:this.p75th(),max:this.max()}}p25th(){return this.percentile(0.25)}p75th(){return this.percentile(0.75)}median(){return this.percentile(0.5)}percentile(p){var cI;cI=~~this.size()*p;if(this.size()%2)return this.valuesSorted()[cI];return (this.valuesSorted()[cI-1]+this.valuesSorted()[cI])/2}norms(){var j,cJ,r,cK,v;r=[];cK=this.data;for(j=0,cJ=cK.length;j<cJ;j++){[t,v]=cK[j];r.push((v-this.mean())/this.stddev())}return r}simplify(cL=0.1){var j,cM,cN,r,cO,_g,_h;cM=this.first();cO=this.max()-this.min();r=[cM];_g=this.data;for(j=0,cN=_g.length;j<cN;j++){_h=_g[j];if((Math.abs(_h[1]-cM[1])/cO)>cL){cM[0]!==r[r.length-1][0]&&r.push(cM);r.push(_h)}cM=_h}cM[0]!==r[r.length-1][0]&&r.push(cM);return e.build(r)}match(cP){var cQ,cR,i,cS,j,_G,_H,I;if(!(cP instanceof c))throw 'Must match against a Timeseries object';cQ=999999999;cS=-1;_G=cP.norms();I=this.norms();if(!(_G.length<=I.length))throw 'Query length exceeds source length';for(i=j=0,_H=I.length-_G.length-1;(0<=_H?j<=_H:j>=_H);i=0<=_H?++j:--j){cR=this._distance(_G,I.slice(i,+(i+_G.length)+1||9e9));cR<cQ&&(cQ=cR,cS=i)}return cS}_distance(cT,cU){var cV,i,j,cW,cX;if(cT.length!==cU.length)throw 'Array lengths must match for distance';cX=0.0;for(i=j=0,cW=cT.length-1;(0<=cW?j<=cW:j>=cW);i=0<=cW?++j:--j){cV=cU[i]-cT[i];cX+=cV*cV}return Math.sqrt(cX)}toString(){return`Timeseries
items   : ${this.size()}
mean    : ${this.mean()}
stddev  : ${this.stddev()}
domain  : ${this.domain()}
range   : ${this.range()}
variance: ${this.variance()}`}};A=class eB extends c{constructor(cZ){var j,dA,dB,dC,dD,dE,dF,_i;super(cZ);this.lookup={};this.attrs=[];dD=this.data;for(j=0,dB=dD.length;j<dB;j++){dC=dD[j];dE=dC[1];for(dA in dE){_i=dE[dA];!this.lookup.hasOwnProperty(dA)&&(this.lookup[dA]=[],this.attrs.push(dA));this.lookup[dA].push([dC[0],_i])}}dF=this.lookup;for(dA in dF){_i=dF[dA];this.lookup[dA]=e.build(this.lookup[dA])}}series(dG){var dH,dI;if(dG[0]==='/')return this.series(dG.substr(1));if(dG.indexOf('/')>0){dI=dG.split('/');dH=dI.shift();if(!this.lookup[dH])return null;return this.lookup[dH].series(dI.join('/'))}if(!this.lookup[dG])return null;return this.lookup[dG]}get(dJ){return this.series(dJ)}limit(dK){var dL,dM,dN,dO;super.limit(dK);dM=this.lookup;dN=[];for(dL in dM){dO=dM[dL];dN.push(dO.limit(dK))}return dN}append(t,v){var dP,dQ;for(dP in v){dQ=v[dP];this.lookup.hasOwnProperty(dP)?this.lookup[dP].append(t,dQ):this.lookup[dP]=e.build([[t,dQ]])}return super.append(t,v)}attr(dR){return this.series(dR)}serieses(){return this.attrs}min(){var dS,dT,dU,dV;dT=[];dU=this.lookup;for(dS in dU){dV=dU[dS];dV.min&&dT.push(dV.min())}return Math.min.apply(Math,dT)}max(){var dW,dX,dY,dZ;dX=[];dY=this.lookup;for(dW in dY){dZ=dY[dW];dZ.max&&dX.push(dZ.max())}return Math.max.apply(Math,dX)}exists(eA){return this.series(eA)!==null}};f=typeof module!=='undefined'&&module.exports?module.exports:window;f.$ts=e}).call(this);

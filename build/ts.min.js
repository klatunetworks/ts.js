var isString=a=>typeof a==='string';var isNumber=a=>typeof a==='number';(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c='function'==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=Error(`Cannot find module '${i}'`);throw a.code='MODULE_NOT_FOUND',a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u='function'==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(A,_){var B,d,E,F,g;F=class TimeseriesFactory{constructor(){}validate(C){if(C.length===0)throw 'Timeseries expects an array of data.';if(C[0].length!==2)throw 'Timeseries expects input like [[timestamp, value]...]';if(!isNumber(C[0][0]))throw 'Timeseries expects timestamps; eg: [[timestamp, value]...]'}timestamp(_a,_b=new Date().getTime(),_c=60000){var i,j,_f,r,v;i=0;r=[];for(j=0,_f=_a.length;j<_f;j++){v=_a[j];r.push([_b+(i++*_c),v])}return r}wrap(D,_B=!0){_B&&this.validate(D);return new E(D)}numeric(_A,aA=!0){if(aA){this.validate(_A);if(!isNumber(_A[0][1]))throw 'NumericTimeseries expects timestamps and numbers; eg: [[timestamp, number]...]'}return new d(_A)}multi(aB,aC=!0){aC&&this.validate(aB);return new B(aB)}build(aD){this.validate(aD);if(isNumber(aD[0][1]))return this.numeric(aD);if(isString(aD[0][1]))return this.wrap(aD);return this.multi(aD)}};g=new F();E=class Timeseries{constructor(aE){this.data=aE;this.squelched=!1;this.listeners=this.init_listeners=[];this.timeframe=null}size(){return this.data.length}empty(){return this.data.length===0}length(){return this.data.length}count(){return this.data.length}slice_indices(aF,aG){var _C,_d;_C=this.nearest(aF);_d=this.nearest(aG);this.time(_C)<aF&&++_C;this.time(_d)<aG&&++_d;return[_C,_d]}limit(aH){this.timeframe=aH;return this}behead(){var aI,aJ,aK;if(this.timeframe===null)return[];aK=this.end()-this.timeframe;aI=0;while (this.data[aI][0]<aK)aI++;aJ=this.data.slice(0,aI);this.data=this.data.slice(aI);return aJ}first(){return this.data[0]}last(){return this.data[this.size()-1]}sample(aL){return this.data[aL]}time(aM){return this.data[aM][0]}value(aN){return this.data[aN][1]}domain(){return[this.first()[0],this.last()[0]]}append(t,v){if(this.empty()){this.data.push([t,v]);return}if(t<this.end())throw 'Can\'t append sample with past timestamp';this.data.push([t,v]);this.behead();return this.notify()}push(t,v){return this.append(t,v)}add(t,v){return this.append(t,v)}notify(){var j,k,aO,_D,_e,_F,G,h;if(this.squelched)return;if(this.size()===2){_F=this.init_listeners;for(j=0,aO=_F.length;j<aO;j++){_e=_F[j];_e()}}G=this.listeners;h=[];for(k=0,_D=G.length;k<_D;k++){_e=G[k];h.push(_e())}return h}listen(fn){return this.listeners.push(fn)}on_init(fn){return this.init_listeners.push(fn)}values(){var j,aP,r,aQ,v;r=[];aQ=this.data;for(j=0,aP=aQ.length;j<aP;j++){[t,v]=aQ[j];r.push(v)}return r}duration(){return this.end()-this.start()}start(){return this.first()[0]}end(){return this.last()[0]}scan(aR,aS){var aT,aU;[aT,aU]=this.slice_indices(aR,aS);return new this.constructor(this.data.slice(aT,aU))}filter(aV){var j,aW,r,_E,aX;r=[];_E=this.data;for(j=0,aW=_E.length;j<aW;j++){aX=_E[j];aV(aX[0],aX[1])&&r.push(aX)}return new this.constructor(r)}split(aY){var j,aZ,bA,bB,bC,_g;bA=bB=[];bC=this.data;for(j=0,aZ=bC.length;j<aZ;j++){_g=bC[j];_g[0]<=aY?bA.push(_g):bB.push(_g)}return[new this.constructor(bA),new this.constructor(bB)]}partition(bD){var bE,j,bF,bG,bH,t,H,v;H=this.start()-Math.abs(this.start()%bD);bH=bE=[];bG=this.data;for(j=0,bF=bG.length;j<bF;j++){[t,v]=bG[j];while (t-H>=bD) {bH.push([H,g.build(bE)]);bE=[];H+=bD}bE.push([t,v])}bE.length>0&&bH.push([H,g.build(bE)]);return g.wrap(bH,!1)}map(bI){var j,bJ,r,bK,bL;r=[];bK=this.data;for(j=0,bJ=bK.length;j<bJ;j++){bL=bK[j];r.push(bI(bL[0],bL[1]))}return g.build(r)}pfold(bM,bN){return this.partition(bM).map(bN)}timestamps(){var j,bO,r,bP,t;r=[];bP=this.data;for(j=0,bO=bP.length;j<bO;j++){[t,v]=bP[j];r.push(t)}return r}nearest(bQ,bR=!1){var bS;if(bQ<=this.start())return 0;if(bQ>=this.end())return this.size()-1;bS=this.bsearch(bQ,0,this.size()-1);(bR&&this.time(bS)>bQ)&&(bS=Math.max(0,bS-1));return bS}bsearch(bT,bU,bV){var bW,bX,bY;bY=~~(bV-bU)/2.0+bU;if(bU===bY){bW=Math.abs(this.time(bU)-bT);bX=Math.abs(this.time(bV)-bT);if(bX>bW)return bU;return bV}else{if(bT<this.time(bY))return this.bsearch(bT,bU,bY);if(bT>this.time(bY))return this.bsearch(bT,bY,bV);else return bY}}toString(){return`Timeseries
items   : ${this.size()}
domain  : ${this.domain()}`}};d=class dC extends E{constructor(bZ){super(bZ)}statistics(){var j,cA,cB,cC,cD,cE,v;if(this._stats)return this._stats;cE=0.0;cC=2e308;cB=-2e308;cD=this.data;for(j=0,cA=cD.length;j<cA;j++){[t,v]=cD[j];cE+=v;v>cB&&(cB=v);v<cC&&(cC=v)}return this._stats={sum:cE,min:cC,max:cB}}behead(){var cF,j,cG,v;cF=super.behead();if(cF.length===0||!this._stats)return;for(j=0,cG=cF.length;j<cG;j++){[t,v]=cF[j];this._stats.sum-=v;if(v===this._stats.min||v===this._stats.max){this._stats=!1;return}}}append(t,v){if(t<this.end())throw 'Can\'t append sample with past timestamp';this._stats&&(this._stats.sum+=v,this._stats.min=Math.min(this._stats.min,v),this._stats.max=Math.max(this._stats.max,v));return super.append(t,v)}sum(){return this.statistics().sum}sumsq(){var j,cH,m,n,r,cI,v;m=this.mean();r=0;cI=this.data;for(j=0,cH=cI.length;j<cH;j++){[t,v]=cI[j];n=v-m;r+=n*n}return r}variance(){return this.sumsq()/(this.size()-1)}stddev(){return Math.sqrt(this.variance())}mean(){return this.sum()/this.size()}range(){return[this.min(),this.max()]}span(){return this.max()-this.min()}min(){return this.statistics().min}max(){return this.statistics().max}values(){var j,cJ,r,cK,v;r=[];cK=this.data;for(j=0,cJ=cK.length;j<cJ;j++){[t,v]=cK[j];r.push(v)}return r}valuesSorted(){if(this._valuesSorted)return this._valuesSorted;return this._valuesSorted=this.values().sort(function(a,b){return a-b})}quartiles(){return{min:this.min(),p25:this.p25th(),mid:this.median(),p75:this.p75th(),max:this.max()}}p25th(){return this.percentile(0.25)}p75th(){return this.percentile(0.75)}median(){return this.percentile(0.5)}percentile(p){var cL;cL=~~this.size()*p;if(this.size()%2)return this.valuesSorted()[cL];return (this.valuesSorted()[cL-1]+this.valuesSorted()[cL])/2}norms(){var j,cM,r,cN,v;r=[];cN=this.data;for(j=0,cM=cN.length;j<cM;j++){[t,v]=cN[j];r.push((v-this.mean())/this.stddev())}return r}simplify(cO=0.1){var j,cP,cQ,r,cR,_G,_h;cP=this.first();cR=this.max()-this.min();r=[cP];_G=this.data;for(j=0,cQ=_G.length;j<cQ;j++){_h=_G[j];if((Math.abs(_h[1]-cP[1])/cR)>cO){cP[0]!==r[r.length-1][0]&&r.push(cP);r.push(_h)}cP=_h}cP[0]!==r[r.length-1][0]&&r.push(cP);return g.build(r)}match(cS){var cT,cU,i,cV,j,cW,_H,I;if(!(cS instanceof E))throw 'Must match against a Timeseries object';cT=999999999;cV=-1;cW=cS.norms();I=this.norms();if(!(cW.length<=I.length))throw 'Query length exceeds source length';for(i=j=0,_H=I.length-cW.length-1;(0<=_H?j<=_H:j>=_H);i=0<=_H?++j:--j){cU=this._distance(cW,I.slice(i,+(i+cW.length)+1||9e9));cU<cT&&(cT=cU,cV=i)}return cV}_distance(cX,cY){var cZ,i,j,dA,dB;if(cX.length!==cY.length)throw 'Array lengths must match for distance';dB=0.0;for(i=j=0,dA=cX.length-1;(0<=dA?j<=dA:j>=dA);i=0<=dA?++j:--j){cZ=cY[i]-cX[i];dB+=cZ*cZ}return Math.sqrt(dB)}toString(){return`Timeseries
items   : ${this.size()}
mean    : ${this.mean()}
stddev  : ${this.stddev()}
domain  : ${this.domain()}
range   : ${this.range()}
variance: ${this.variance()}`}};B=class eF extends E{constructor(dD){var j,dE,dF,dG,dH,dI,dJ,_i;super(dD);this.lookup={};this.attrs=[];dH=this.data;for(j=0,dF=dH.length;j<dF;j++){dG=dH[j];dI=dG[1];for(dE in dI){_i=dI[dE];!this.lookup.hasOwnProperty(dE)&&(this.lookup[dE]=[],this.attrs.push(dE));this.lookup[dE].push([dG[0],_i])}}dJ=this.lookup;for(dE in dJ){_i=dJ[dE];this.lookup[dE]=g.build(this.lookup[dE])}}series(dK){var dL,dM;if(dK[0]==='/')return this.series(dK.substr(1));if(dK.indexOf('/')>0){dM=dK.split('/');dL=dM.shift();if(!this.lookup[dL])return null;return this.lookup[dL].series(dM.join('/'))}if(!this.lookup[dK])return null;return this.lookup[dK]}get(dN){return this.series(dN)}limit(dO){var dP,dQ,dR,dS;super.limit(dO);dQ=this.lookup;dR=[];for(dP in dQ){dS=dQ[dP];dR.push(dS.limit(dO))}return dR}append(t,v){var dT,dU;for(dT in v){dU=v[dT];this.lookup.hasOwnProperty(dT)?this.lookup[dT].append(t,dU):this.lookup[dT]=g.build([[t,dU]])}return super.append(t,v)}attr(dV){return this.series(dV)}serieses(){return this.attrs}min(){var dW,dX,dY,dZ;dX=[];dY=this.lookup;for(dW in dY){dZ=dY[dW];dZ.min&&dX.push(dZ.min())}return Math.min.apply(Math,dX)}max(){var eA,eB,eC,eD;eB=[];eC=this.lookup;for(eA in eC){eD=eC[eA];eD.max&&eB.push(eD.max())}return Math.max.apply(Math,eB)}exists(eE){return this.series(eE)!==null}};_.exports=g},{}]},{},[1]);
